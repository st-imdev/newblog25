{{ define "main" }}
<section class="container py-16">
  <article class="max-w-prose">
    <!-- Header with theme toggle -->
    <header class="mb-10 flex justify-between items-center">
      <div class="mb-6">
        <a href="/" class="inline-flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors group">
          <span class="back-arrow">←</span>
          Back to home
        </a>
      </div>
      <div class="theme-toggle">
        <button id="theme-switch" class="theme-switch" aria-label="Toggle dark mode"><span class="knob"></span></button>
      </div>
      <script>
        (function(){
          var el = document.getElementById('theme-switch');
          if(!el) return;
          function apply(state){
            if(state==='dark'){ document.documentElement.classList.add('dark'); el.setAttribute('data-state','dark'); }
            else { document.documentElement.classList.remove('dark'); el.removeAttribute('data-state'); }
            try{ localStorage.setItem('theme', state); }catch(e){}
          }
          try{ apply(localStorage.getItem('theme')||'light'); }catch(e){}
          el.addEventListener('click', function(){
            var dark = document.documentElement.classList.contains('dark');
            apply(dark ? 'light' : 'dark');
          });
        })();
      </script>
    </header>
    
    <div class="animate-fade-in">
      <header class="mb-8">
        <h1 class="h1 mb-4">{{ .Title }}</h1>
        {{ with .Date }}
        <p class="text-sm text-muted-foreground">{{ .Format "January 2006" }}</p>
        {{ end }}
      </header>

      {{ $content := .Content | replaceRE `==([^=]+)==` `<span class="highlight">$1</span>` | safeHTML }}
      <div class="content prose prose-lg max-w-none">{{ $content }}</div>

      <footer class="mt-16 pt-8 border-t" style="border-color: hsl(var(--border));">
        <a href="/" class="text-muted-foreground hover:text-foreground transition-colors" style="text-decoration: underline; text-decoration-thickness: 1px; text-underline-offset: 4px;">
          ← Back to home
        </a>
      </footer>
    </div>
  </article>
</section>
{{ end }}