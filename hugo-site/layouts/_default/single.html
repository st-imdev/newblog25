{{ define "main" }}
<main class="min-h-screen bg-background text-foreground">
  <div class="container py-4 sm:py-8 flex gap-8 max-w-6xl">
    {{ $toc := .TableOfContents }}
    {{ $hasToc := gt (len (findRE "<li>" $toc)) 0 }}
    <!-- Sidebar only when headings exist -->
    {{ if $hasToc }}
    <aside class="w-64 shrink-0 hidden lg:block">
      <div class="sticky top-8">
        <h2 class="text-sm font-medium text-muted-foreground mb-4">Contents</h2>
        <nav class="space-y-2 text-muted-foreground">{{ $toc | safeHTML }}</nav>
      </div>
    </aside>
    {{ end }}
    <!-- Main Content -->
    <div class="flex-1 px-4 sm:px-0 {{ if $hasToc }}max-w-2xl{{ else }}max-w-prose{{ end }}">
      <!-- Header within content container to match homepage -->
      <section class="py-8">
        <header class="mb-6 flex justify-between items-center">
          <a href="/" class="h1" style="text-decoration:none;">Scott Taylor</a>
          <div class="theme-toggle">
            <button id="theme-switch" class="theme-switch" aria-label="Toggle dark mode"><span class="knob"></span></button>
          </div>
        </header>
        <script>
          (function(){
            var el = document.getElementById('theme-switch');
            if(!el) return;
            function apply(state){
              if(state==='dark'){ document.documentElement.classList.add('dark'); el.setAttribute('data-state','dark'); }
              else { document.documentElement.classList.remove('dark'); el.removeAttribute('data-state'); }
              try{ localStorage.setItem('theme', state); }catch(e){}
            }
            try{ apply(localStorage.getItem('theme')||'light'); }catch(e){}
            el.addEventListener('click', function(){
              var dark = document.documentElement.classList.contains('dark');
              apply(dark ? 'light' : 'dark');
            });
          })();
        </script>
      </section>
      
      <article class="animate-fade-in">
        <header class="mb-8">
          <h1 class="post-title mb-4">{{ .Title }}</h1>
          {{ with .Date }}
          <p class="text-sm text-muted-foreground">{{ .Format "January 2006" }}</p>
          {{ end }}
        </header>

        {{ $content := .Content | replaceRE `==([^=]+)==` `<span class="highlight">$1</span>` | safeHTML }}
        <div class="content prose prose-lg max-w-none">{{ $content }}</div>

        <footer style="margin-top: 4rem; padding-top: 2rem; border-top: 1px solid hsl(var(--border));">
          <a href="/" style="color: hsl(var(--muted-foreground)); text-decoration: underline; text-decoration-thickness: 1px; text-underline-offset: 4px; transition: color 0.15s ease;" 
             onmouseover="this.style.color='hsl(var(--foreground))'" 
             onmouseout="this.style.color='hsl(var(--muted-foreground))'">
            ‚Üê Back to home
          </a>
        </footer>
      </article>
    </div>
  </div>
</main>
{{ end }}